hex
81 constant SSD1306_SETCONTRAST
A4 constant SSD1306_DISPLAYALLON_RESUME
A5 constant SSD1306_DISPLAYALLON
A6 constant SSD1306_NORMALDISPLAY
A7 constant SSD1306_INVERTDISPLAY
AE constant SSD1306_DISPLAYOFF
AF constant SSD1306_DISPLAYON

D3 constant SSD1306_SETDISPLAYOFFSET
DA constant SSD1306_SETCOMPINS

DB constant SSD1306_SETVCOMDETECT

D5 constant SSD1306_SETDISPLAYCLOCKDIV
D9 constant SSD1306_SETPRECHARGE

A8 constant SSD1306_SETMULTIPLEX 0xA8

00 constant SSD1306_SETLOWCOLUMN
10 constant SSD1306_SETHIGHCOLUMN

40 constant SSD1306_SETSTARTLINE 0x40

20 constant SSD1306_MEMORYMODE
21 constant SSD1306_COLUMNADDR
22 constant SSD1306_PAGEADDR

C0 constant SSD1306_COMSCANINC
C8 constant SSD1306_COMSCANDEC

A0 constant SSD1306_SEGREMAP 0xA0

8D constant SSD1306_CHARGEPUMP

\ Scrolling #defines
2F constant SSD1306_ACTIVATE_SCROLL
2E constant SSD1306_DEACTIVATE_SCROLL
A3 constant SSD1306_SET_VERTICAL_SCROLL_AREA
26 constant SSD1306_RIGHT_HORIZONTAL_SCROLL
27 constant SSD1306_LEFT_HORIZONTAL_SCROLL
29 constant SSD1306_VERTICAL_AND_RIGHT_HORIZONTAL_SCROLL
2A constant SSD1306_VERTICAL_AND_LEFT_HORIZONTAL_SCROLL

decimal
26 constant SSD1306_INIT_SEQ_LENGTH
LCD_HWHEIGHT 8 / 1 - constant SSD1306_PAGE_END_ADDRESS
hex

SSD1306_DISPLAYOFF
SSD1306_SETDISPLAYCLOCKDIV 80
SSD1306_SETMULTIPLEX LCD_HWHEIGHT 1 -
SSD1306_SETDISPLAYOFFSET 0
SSD1306_SETSTARTLINE
SSD1306_CHARGEPUMP SSD1306_EXTERNALVCC [IF] 10 [ELSE] 14 [THEN]
SSD1306_MEMORYMODE 0
SSD1306_SEGREMAP 1 or
SSD1306_COMSCANDEC

SSD1306_128_32 [IF]
  SSD1306_SETCOMPINS 2
  SSD1306_SETCONTRAST LCD_MAX_CONTRAST
[THEN]
SSD1306_128_64 [IF]
  SSD1306_SETCOMPINS 12
  SSD1306_SETCONTRAST SSD1306_EXTERNALVCC [IF] 9F [ELSE] CF [THEN]
[THEN]
SSD1306_96_16 [IF]
  SSD1306_SETCOMPINS 2
  SSD1306_SETCONTRAST SSD1306_EXTERNALVCC [IF] 10 [ELSE] AF [THEN]
[THEN]

SSD1306_SETPRECHARGE SSD1306_EXTERNALVCC [IF] 22 [ELSE] F1 [THEN]
SSD1306_SETVCOMDETECT 40
SSD1306_DISPLAYALLON_RESUME
SSD1306_NORMALDISPLAY
SSD1306_DEACTIVATE_SCROLL
SSD1306_DISPLAYON
decimal

carray ssd1306_init_seq SSD1306_INIT_SEQ_LENGTH

LCD_WIDTH LCD_HEIGHT * 16 / constant SSD1306_BUFFER_SIZE

array ssd1306_buffer SSD1306_BUFFER_SIZE
0 0 iarray ssd1306_command_buffer 2

: ssd1306_command
  ssd1306_command_buffer dup 1 + !
  2 SSD1306_I2C_Write
;

SH1106
: LcdInit
  [IF] 50 delayms [THEN]
  SSD1306_INIT_SEQ_LENGTH 0 do ssd1306_init_seq I + @ ssd1306_command loop
;
